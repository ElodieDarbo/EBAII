---
title: "EBAIIn2 - ChIP-seq Workshop - Peak annotation"
author: "Stephanie Le Gras"
date: "2021 May, 27th"
output:
  html_document: default
  pdf_document:
    fig_caption: yes
    keep_tex: yes
    toc: true
    toc_depth: 3
params:
  ensembl: 103
  assembly: hg38
  organism: Homo sapiens
bibliography: references.bib
---

```{r setup, include=FALSE}
#setwd("/Volumes/ngs/illumina/slegras/B21000_EBAIIv2/")
knitr::opts_knit$set(echo = TRUE,  root.dir="/Volumes/ngs/illumina/slegras/B21000_EBAIIv2", fig.path = "images/")

```

## Heatmaps
During this session, we are going to use various R packages.
```{r loadPackage, include=TRUE}
## loading packages
library(ChIPseeker)
library(TxDb.Hsapiens.UCSC.hg38.knownGene)
txdb <- TxDb.Hsapiens.UCSC.hg38.knownGene
```

### Profile of ChIP peaks binding to TSS regions
First of all, for calculating the profile of ChIP peaks binding to TSS regions, we should prepare the TSS regions, which are defined as the flanking sequence of the TSS sites. Then align the peaks that are mapping to these regions, and generate the tagMatrix.

```{r prepareMatrix, include=TRUE}
peak <- readPeakFile("2021-05-07_PeakCalling/BRG1siCTRL_CHIP-seq/BRG1siCTRL_CHIP-seq_peaks.narrowPeak", as="GRanges")

peakHeatmap(peak, TxDb=txdb, upstream=3000, downstream=3000, color="red")
```

### Average Profile of ChIP peaks binding to TSS region
```{r averageProfile, include=TRUE}
plotAvgProf2(peak, TxDb=txdb, upstream=3000, downstream=3000,
             xlab="Genomic Region (5'->3')", ylab = "Read Count Frequency")
```
